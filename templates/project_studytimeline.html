<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>BPX Dashboard</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/mdi/css/materialdesignicons.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/ti-icons/css/themify-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/css/vendor.bundle.base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/font-awesome/css/font-awesome.min.css') }}">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/select2/select2.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/select2-bootstrap-theme/select2-bootstrap.min.css') }}">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='assets/images/favicon.png') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css">
    <style type="text/css">
        .box-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .milestone {
            flex: 1;
            text-align: center;
            position: relative;
            min-width: 125px;
            max-width: 135px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .milestone .circle {
            width: 25px;
            height: 25px;
            border: 3px solid black;
            border-radius: 50%;
            display: inline-block;
            background-color: white;
            position: relative;
        }
        .milestone .line {
            height: 3px;
            width: 100%;
            background-color: black;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            z-index: -1;
        }
        .milestone input {
            display: block;
            margin: 10px auto;
            width: 85%;
        }
        .milestone:first-child .line {
            width: 50%;
            left: 75%;
        }
        .milestone:last-child .line {
            width: 50%;
            left: 0;
        }
    </style>

  </head>

  <body>
    <div class="container-scroller">
      <!-- partial:../../partials/_navbar.html -->
      <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-start">
          <a class="navbar-brand brand-logo" href="#" ><img src="{{ url_for('static', filename='assets/images/bpxlogo.svg') }}" alt="logo" />
          </a>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-stretch">
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-menu"></span>
          </button>
          <div class="search-field d-none d-md-block">
            <form class="d-flex align-items-center h-100" action="#">
              <div class="input-group">
                <div class="input-group-prepend bg-transparent">
                  <i class="input-group-text border-0 mdi mdi-magnify"></i>
                </div>
                <input type="text" class="form-control bg-transparent border-0" placeholder="Search projects">
              </div>
            </form>
          </div>
          <ul class="navbar-nav navbar-nav-right">
         
            <li class="nav-item d-none d-lg-block full-screen-link">
              <a class="nav-link">
                <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link count-indicator dropdown-toggle" id="messageDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="mdi mdi-email-outline"></i>
                <span class="count-symbol bg-warning"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="messageDropdown">
                <h6 class="p-3 mb-0">Messages</h6>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <img src="../../assets/images/faces/face4.jpg" alt="image" class="profile-pic">
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject ellipsis mb-1 font-weight-normal">Mark send you a message</h6>
                    <p class="text-gray mb-0"> 1 Minutes ago </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <img src="../../assets/images/faces/face2.jpg" alt="image" class="profile-pic">
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject ellipsis mb-1 font-weight-normal">Cregh send you a message</h6>
                    <p class="text-gray mb-0"> 15 Minutes ago </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <img src="../../assets/images/faces/face3.jpg" alt="image" class="profile-pic">
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject ellipsis mb-1 font-weight-normal">Profile picture updated</h6>
                    <p class="text-gray mb-0"> 18 Minutes ago </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <h6 class="p-3 mb-0 text-center">4 new messages</h6>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#" data-bs-toggle="dropdown">
                <i class="mdi mdi-bell-outline"></i>
                <span class="count-symbol bg-danger"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="notificationDropdown">
                <h6 class="p-3 mb-0">Notifications</h6>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-success">
                      <i class="mdi mdi-calendar"></i>
                    </div>
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject font-weight-normal mb-1">Event today</h6>
                    <p class="text-gray ellipsis mb-0"> Just a reminder that you have an event today </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-warning">
                      <i class="mdi mdi-cog"></i>
                    </div>
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject font-weight-normal mb-1">Settings</h6>
                    <p class="text-gray ellipsis mb-0"> Update dashboard </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-info">
                      <i class="mdi mdi-link-variant"></i>
                    </div>
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject font-weight-normal mb-1">Launch Admin</h6>
                    <p class="text-gray ellipsis mb-0"> New admin wow! </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <h6 class="p-3 mb-0 text-center">See all notifications</h6>
              </div>
            </li>
            <li class="nav-item nav-logout d-none d-lg-block">
              <a class="nav-link" href="#">
                <i class="mdi mdi-power"></i>
              </a>
            </li>
            <li class="nav-item nav-settings d-none d-lg-block">
              <a class="nav-link" href="#">
                <i class="mdi mdi-format-line-spacing"></i>
              </a>
            </li>
          </ul>
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
            <span class="mdi mdi-menu"></span>
          </button>
        </div>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:../../partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">

            <li class="nav-item">
              <a class="nav-link" href="/">
                <span class="menu-title">Dashboard</span>
                <i class="mdi mdi-home menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/projectoverview">
                <span class="menu-title">Project Overview</span>
                <i class="mdi mdi-clipboard-outline menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/finance">
                <span class="menu-title">Financial Foecast</span>
                <i class="mdi mdi-chart-line menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/projectactivity">
                <span class="menu-title">Project Activity</span>
                <i class="mdi  mdi-clipboard-text menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/studytimeline">
                <span class="menu-title">Project Study</span>
                <i class="mdi mdi-calendar-check menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/notes_issues">
                <span class="menu-title">Notes & Issue</span>
                <i class="mdi mdi-calendar-check menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/project_milestone">
                <span class="menu-title">Projectt Milestone</span>
                <i class="mdi mdi-calendar-check menu-icon"></i>
              </a>
            </li>

          </ul>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header">
              <h3 class="page-title"> Project Study Timeline </h3>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="/">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Project Study Timeline </li>
                </ol>
              </nav>
            </div>
            <div class="row">
              <div class="col-12 grid-margin">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">Project Study</h4>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">Add</button>
<button id='btn_save' class="btn btn-success">Save</button><br>

<table class="table">
    <thead>
        <tr>
            <th>Milestones</th>
        </tr>
    </thead>
    <tbody id="tableBody">
        <!-- Rows will be added here -->
    </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">Add Boxes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="number" id="boxCount" class="form-control" placeholder="Enter number of boxes">
            </div>
          <div class="row">
            <div class="col">
              <input type="date" class="form-control" placeholder="Enter Start Date" id='d1'>
            </div>
          <div class="col">
             <input type="date" class="form-control" placeholder="Enter Stop Date" id='d2'>
          </div>
        </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="dangerbtn">Close</button>
                <button type="button" class="btn btn-primary" onclick="addBoxes()">Add</button>
            </div>
        </div>
    </div>
</div>

                    
                    <!-- <div id="example4.2" style="height: 700px;"></div> -->
                  </div>
                </div>
              </div>

   
              <div class="col-md-6 grid-margin stretch-card">
                <div class="card">

            </div>
          </div>
    <!-- The Modal -->
<!-- <div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">

       Modal Header 
      <div class="modal-header">
        <h4 class="modal-title">Project study</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

     
      <div class="modal-body">
          <div class="mb-3 mt-3">
              <label  class="form-label">Cost Estimate:</label>
              <input type="number" class="form-control" id="costetimate" placeholder="Enter cost Estimate" >
          </div>
         <div class="row">
            <div class="col">
              <input type="date" class="form-control" placeholder="Enter Start Date" id='d1'>
            </div>
          <div class="col">
             <input type="date" class="form-control" placeholder="Enter Stop Date" id='d2'>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="btnclose">Close</button>
        <button type="button" id='btn_modalsave' class="btn btn-success">Save</button>
      </div>

    </div>
  </div>
</div> -->
          <!-- content-wrapper ends -->
          <!-- partial:../../partials/_footer.html -->
          <footer class="footer">
            <div class="d-sm-flex justify-content-center justify-content-sm-between">
              <span class="text-muted text-center text-sm-left d-block d-sm-inline-block"><h4>BPX Team</h4></span>
              <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Admin@biopharmatics.com</span>
            </div>
          </footer>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="{{ url_for('static', filename='assets/vendors/js/vendor.bundle.base.js') }}"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="{{ url_for('static', filename='assets/vendors/select2/select2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/vendors/typeahead.js/typeahead.bundle.min.js') }}"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="{{ url_for('static', filename='assets/js/off-canvas.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/misc.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/settings.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/todolist.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.cookie.js') }}"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="{{ url_for('static', filename='assets/js/file-upload.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/typeahead.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/select2.js') }}"></script>
    <!-- End custom js for this page -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

<!-- Add your JavaScript code here -->
<script>
  var permonth_cost=0
          function calculateMonthsBetweenDates(startDate, endDate) {
            var start = new Date(startDate);
            var end = new Date(endDate);

            var years = end.getFullYear() - start.getFullYear();
            var months = (end.getMonth() - start.getMonth()) + (years * 12);

            // Adjust for partial months
            if (end.getDate() < start.getDate()) {
                months--;
            }

            return months;
        }

      // function addBoxes() {
      //   $('#dangerbtn').click();
      //   const cost = document.getElementById('boxCount').value;

      //   const d1 = document.getElementById('d1').value;
      //   const d2 = document.getElementById('d2').value;
      //   const boxCount = calculateMonthsBetweenDates(d1,d2);
      //    permonth_cost = Math.round(cost/boxCount);
        function addBoxes() {
          $('#dangerbtn').click();
        const cost = document.getElementById('boxCount').value;
        const d1 = document.getElementById('d1').value;
        const d2 = document.getElementById('d2').value;
        const boxCount = calculateMonthsBetweenDates(d1,d2);
        permonth_cost = Math.round(cost/boxCount);
        const tableBody = document.getElementById('tableBody');
        
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        const boxContainer = document.createElement('div');
        boxContainer.classList.add('box-container');
        
        for (let i = 0; i < boxCount; i++) {
            createMilestone(boxContainer, i + 1);
        }
        
        cell.appendChild(boxContainer);
        row.appendChild(cell);
        tableBody.insertBefore(row, tableBody.firstChild);
        
        // Close the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('myModal'));
        modal.hide();
    }

    function createMilestone(container, milestoneNumber, cost = '', date = '') {
        const milestone = document.createElement('div');
        milestone.classList.add('milestone');

        const circle = document.createElement('div');
        circle.classList.add('circle');

        const line = document.createElement('div');
        line.classList.add('line');

        const label = document.createElement('div');
        label.textContent = `Milestone ${milestoneNumber}`;

        const costInput = document.createElement('input');
        costInput.type = 'text';
        costInput.classList.add('form-control');
        costInput.placeholder = 'Cost';
        costInput.value = permonth_cost;

        const dateInput = document.createElement('input');
        dateInput.type = 'date';
        dateInput.classList.add('form-control');
        dateInput.value = date;

        milestone.appendChild(circle);
        milestone.appendChild(line);
        milestone.appendChild(label);
        milestone.appendChild(costInput);
       // milestone.appendChild(dateInput);

        container.appendChild(milestone);
    }

    document.getElementById('btn_save').addEventListener('click', function () {
        const tableBody = document.getElementById('tableBody');
        const rows = tableBody.getElementsByTagName('tr');
        const data = [];

        Array.from(rows).forEach((row) => {
            const boxContainer = row.querySelector('.box-container');
            const milestones = boxContainer.getElementsByClassName('milestone');
            const rowData = [];

            Array.from(milestones).forEach((milestone, index) => {
                const costInput = milestone.querySelector('input[type="text"]');
                const dateInput = milestone.querySelector('input[type="date"]');
                rowData.push({ milestone: index + 1, cost: costInput.value, date: dateInput.value });
            });

            data.push(rowData);
        });

        fetch('/save_data2', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            alert('Data saved successfully');
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
//////////////////////////////////////////////////////////////////////////////
      function create_Milestone_2(container, milestoneNumber, cost = '', date = '') {
        const milestone = document.createElement('div');
        milestone.classList.add('milestone');

        const circle = document.createElement('div');
        circle.classList.add('circle');

        const line = document.createElement('div');
        line.classList.add('line');

        const label = document.createElement('div');
        label.textContent = `Milestone ${milestoneNumber}`;

        const costInput = document.createElement('input');
        costInput.type = 'text';
        costInput.classList.add('form-control');
        costInput.placeholder = 'Cost';
        costInput.value = cost;

        const dateInput = document.createElement('input');
        dateInput.type = 'date';
        dateInput.classList.add('form-control');
        dateInput.value = date;

        milestone.appendChild(circle);
        milestone.appendChild(line);
        milestone.appendChild(label);
        milestone.appendChild(costInput);
        //milestone.appendChild(dateInput);

        container.appendChild(milestone);
    }
    function loadData() {
        fetch('/load_data2')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('tableBody');

            data.forEach((row) => {
                const rowElement = document.createElement('tr');
                const cell = document.createElement('td');
                const boxContainer = document.createElement('div');
                boxContainer.classList.add('box-container');
                
                row.forEach((item, index) => {
                    create_Milestone_2(boxContainer, index + 1, item.cost, item.date);
                });

                cell.appendChild(boxContainer);
                rowElement.appendChild(cell);
                tableBody.appendChild(rowElement);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    // Load data when the page loads
    document.addEventListener('DOMContentLoaded', loadData);

</script>

  </body>
</html>